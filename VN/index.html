<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¶Šå—è¡Œå‰èªªæ˜æœƒç”¢ç”Ÿå™¨</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            darkMode: 'media',
            theme: {
                extend: {
                    colors: {
                        'vn-primary': '#0F766E',  // èˆ’é©çš„æ¹–æ°´ç¶ /è—ç¶ è‰²
                        'vn-accent': '#F59E0B',   // æº«æš–çš„ç¥ç€é»ƒ
                        'vn-bg': '#F0FDFA',       // æ¥µæ·ºçš„è–„è·åº•è‰²
                        'vn-dark': '#134E4A',     // æ·±è—ç¶ 
                        'vn-card-dark': '#2d3748'
                    }
                }
            }
        }
    </script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <style>
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        body { background-color: #f0f2f5; font-family: "Microsoft JhengHei", -apple-system, sans-serif; }
        
        .phone-frame {
            border: 14px solid #1a1a1a;
            border-radius: 40px;
            overflow: hidden;
            position: relative;
            background: white;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            transition: all 0.3s ease;
        }
        .phone-notch {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 25px;
            background: #1a1a1a;
            border-bottom-left-radius: 12px;
            border-bottom-right-radius: 12px;
            z-index: 50;
        }
        /* ç«¹ç·¨ç´‹ç† (Bamboo Weave Pattern) */
        .bamboo-weave {
            background-color: #0F766E;
            background-image: 
                linear-gradient(45deg, rgba(255,255,255,0.08) 25%, transparent 25%, transparent 75%, rgba(255,255,255,0.08) 75%, rgba(255,255,255,0.08)), 
                linear-gradient(135deg, rgba(255,255,255,0.08) 25%, transparent 25%, transparent 75%, rgba(255,255,255,0.08) 75%, rgba(255,255,255,0.08));
            background-size: 20px 20px;
            background-position: 0 0, 10px 0;
        }
        .tab-active { color: #0F766E; border-bottom: 3px solid #0F766E; font-weight: 700; }
        @media (prefers-color-scheme: dark) {
            .tab-active { color: #2DD4BF; border-bottom: 3px solid #2DD4BF; }
        }
        .tab-inactive { color: #A0AEC0; }
        .custom-checkbox input:checked + div { background-color: #0F766E; border-color: #0F766E; }
        .custom-checkbox input:checked + div:after { content: "âœ“"; color: white; display: block; text-align: center; line-height: 20px; font-size: 14px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- é è¨­è³‡æ–™ (è¶Šå—ç‰ˆ) ---
        const DEFAULT_DATA = {
            tripName: "å³´åœ¨å°±å»~å·´æ‹¿å±±ä½›æ‰‹ã€æœƒå®‰å¤é®ã€ç¾å±±è–åœ°ã€å¤œéŠéŸ“æ±Ÿå…­æ—¥",
            tripCode: "DAD06260125A",
            dateRange: "2026/01/25", 
            meeting: { 
                date: "2026/01/25", 
                time: "16:10", 
                location: "æ¡ƒåœ’åœ‹éš›æ©Ÿå ´ç¬¬ä¸€èˆªå»ˆ è¶Šç«¹èˆªç©º(QH) 11è™Ÿæ«ƒæª¯å‰æ–¹ é›†åˆ", 
                badge: "æ–°é­…åŠ›æ—…éŠ(é»ƒ)", 
                airportStaff: "å°å‘¨ 0933-729400" 
            },
            guide: { name: "", twPhone: "", localPhone: "" }, 
            flights: [
                { 
                    type: "å»ç¨‹", airline: "è¶Šç«¹èˆªç©º", code: "QH9551", date: "01/25",
                    depTime: "19:10", depAirport: "TPE æ¡ƒåœ’", 
                    arrTime: "21:05", arrAirport: "DAD å³´æ¸¯" 
                },
                { 
                    type: "å›ç¨‹", airline: "è¶Šç«¹èˆªç©º", code: "QH9550", date: "01/30",
                    depTime: "14:30", depAirport: "DAD å³´æ¸¯", 
                    arrTime: "18:10", arrAirport: "TPE æ¡ƒåœ’" 
                }
            ],
            days: [
                { 
                    day: 1, 
                    date: "1/25", 
                    location: "æœƒå®‰", 
                    lat: 15.88, lon: 108.33, 
                    spots: [{ name: "å³´æ¸¯æ©Ÿå ´", desc: "æŠµé”å³´æ¸¯ï¼Œå‰å¾€æœƒå®‰ã€‚" }],
                    meals: { b: "æº«æš–çš„å®¶", l: "æ©Ÿä¸Š", d: "æ©Ÿä¸Šå¥—é¤" },
                    hotel: "EMM Hotel Hoi An",
                    hotelTel: "84-235-6269-999",
                    hotelAddress: "Hoi An, Vietnam"
                }
            ],
            info: {
                weather: "è¶Šå—ä¸­éƒ¨(å³´æ¸¯/æœƒå®‰) 1-2æœˆæ°£æº«èˆ’é©ï¼Œç´„ 19-25 åº¦ã€‚æ—©æ™šç¨æ¶¼å»ºè­°å¸¶è–„å¤–å¥—ï¼Œç™½å¤©æº«æš–ã€‚",
                currency: "è¶Šå—ç›¾ (VND)ã€‚1 å°å¹£ç´„å¯æ› 750-800 è¶Šå—ç›¾ã€‚å»ºè­°å¸¶å°å¹£æˆ–ç¾é‡‘åˆ°ç•¶åœ°ç”±å°éŠå”åŠ©å…Œæ›ã€‚",
                voltage: "220Vã€‚æ’åº§é€šå¸¸ç‚ºé›™å­”åœ“å½¢ (æ­è¦) æˆ–é›™å­”æ‰å½¢ (ç¾è¦)ï¼Œå¤§éƒ¨åˆ†å°ç£é›»å™¨ (æ‰‹æ©Ÿ/ç›¸æ©Ÿå……é›»å™¨) å¯ç›´æ¥ä½¿ç”¨ï¼Œä½†å¹é¢¨æ©Ÿè«‹ç¢ºèªé›»å£“ã€‚",
                baggage: "åš´ç¦æ”œå¸¶è‚‰é¡è£½å“å…¥å¢ƒã€‚è¡Œå‹•é›»æºè«‹éš¨èº«æ”œå¸¶ã€‚æ¯äººæ‰˜é‹è¡Œæä¾èˆªç©ºå…¬å¸è¦å®š (é€šå¸¸ç‚º 20kg)ã€‚",
                imageRoot: "",
                pdfPath: "",
                surveyUrl: "",
                tips: {
                    perDay: 300,
                    days: 6,
                    currency: "æ–°å°å¹£"
                }
            }
        };

        const CITIES = {
            "å°åŒ—": { lat: 25.03, lon: 121.56 },
            "æ²³å…§": { lat: 21.02, lon: 105.83 },
            "èƒ¡å¿—æ˜å¸‚": { lat: 10.82, lon: 106.62 },
            "å³´æ¸¯": { lat: 16.05, lon: 108.20 },
            "æœƒå®‰": { lat: 15.88, lon: 108.33 },
            "é †åŒ–": { lat: 16.46, lon: 107.59 },
            "ä¸‹é¾ç£": { lat: 20.95, lon: 107.08 },
            "é™¸é¾ç£(å¯§å¹³)": { lat: 20.25, lon: 105.97 },
            "èŠ½èŠ": { lat: 12.23, lon: 109.19 },
            "å¤§å»": { lat: 11.94, lon: 108.43 },
            "å¯Œåœ‹å³¶": { lat: 10.28, lon: 103.98 },
            "æ²™å£©": { lat: 22.33, lon: 103.84 },
            "èŠ¹è‹´": { lat: 10.04, lon: 105.78 },
            "æµ·é˜²": { lat: 20.84, lon: 106.68 }
        };

        // --- Client HTML ç”Ÿæˆ ---
        function getClientHtml(data) {
            const jsonStr = JSON.stringify(data);
            
            let badgeColorClass = "bg-gray-500";
            if (data.meeting.badge.includes("æ©˜")) badgeColorClass = "bg-orange-500";
            else if (data.meeting.badge.includes("è—")) badgeColorClass = "bg-blue-600";
            else if (data.meeting.badge.includes("ç¶ ")) badgeColorClass = "bg-green-600";
            else if (data.meeting.badge.includes("ç´«")) badgeColorClass = "bg-purple-600";
            else if (data.meeting.badge.includes("ç´…")) badgeColorClass = "bg-red-600"; 
            else if (data.meeting.badge.includes("é»ƒ")) badgeColorClass = "bg-yellow-500";
            
            const totalTips = (data.info.tips.perDay * data.info.tips.days).toLocaleString();
            
            let imageList = [];
            let imgInput = (data.info.imageRoot || "").trim();
            if (imgInput) {
                if (imgInput.includes("\n") || imgInput.includes(",")) {
                    imageList = imgInput.split(/[\n,]+/).map(s => s.trim()).filter(s => s);
                } else if (/\.(jpg|jpeg|png|gif|webp|bmp)$/i.test(imgInput)) {
                    imageList = [imgInput];
                } else {
                    const path = imgInput.endsWith('/') ? imgInput : imgInput + '/';
                    imageList = [1,2,3,4,5,6,7,8].map(i => `${path}img${i}.jpg`);
                }
            }

            // é ˜éšŠåˆ¤æ–·
            const hasLeader = data.guide.name && data.guide.name.trim() !== "" && data.guide.name.trim().toUpperCase() !== "NIL";
            const tipTitleText = hasLeader ? "é ˜éšŠå°éŠå¸æ©Ÿ" : "å°éŠå¸æ©Ÿ";
            const tipPayText = hasLeader ? "é ˜éšŠ" : "å°éŠ";

            // showDriverCardHint å®šç¾©
            const showDriverCardHint = data.days.some(d => d.hotelAddress && d.hotelAddress.trim() !== "");

            // HTML Parts
            const htmlParts = [
                '<!DOCTYPE html>',
                '<html lang="zh-TW">',
                '<head>',
                '    <meta charset="UTF-8">',
                '    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">',
                `    <title>${data.tripName}</title>`,
                '    <script src="https://cdn.tailwindcss.com"><\/script>',
                '    <script>',
                '        tailwind.config = {',
                '            darkMode: "media",',
                '            theme: {',
                '                extend: {',
                '                    colors: {',
                '                        "vn-primary": "#0F766E",',
                '                        "vn-accent": "#F59E0B",',
                '                        "vn-bg": "#F0FDFA",',
                '                        "vn-dark": "#134E4A",',
                '                        "vn-card-dark": "#2d3748"',
                '                    }',
                '                }',
                '            }',
                '        }',
                '    <\/script>',
                '    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">',
                '    <style>',
                '        @import url("https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap");',
                '        body { font-family: "Noto Sans TC", sans-serif; background-color: #F0FDFA; -webkit-tap-highlight-color: transparent; }',
                '        .no-scrollbar::-webkit-scrollbar { display: none; }',
                '        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }',
                '        .card-shadow { box-shadow: 0 4px 15px rgba(0,0,0,0.05); }',
                '        .bamboo-weave {',
                '            background-color: #0F766E;',
                '            background-image: ',
                '                linear-gradient(45deg, rgba(255,255,255,0.08) 25%, transparent 25%, transparent 75%, rgba(255,255,255,0.08) 75%, rgba(255,255,255,0.08)), ',
                '                linear-gradient(135deg, rgba(255,255,255,0.08) 25%, transparent 25%, transparent 75%, rgba(255,255,255,0.08) 75%, rgba(255,255,255,0.08));',
                '            background-size: 20px 20px;',
                '            background-position: 0 0, 10px 0;',
                '        }',
                '        .tab-active { color: #0F766E; border-bottom: 3px solid #0F766E; font-weight: 700; }',
                '        @media (prefers-color-scheme: dark) {',
                '            .tab-active { color: #2DD4BF; border-bottom: 3px solid #2DD4BF; }',
                '        }',
                '        .tab-inactive { color: #A0AEC0; }',
                '        .custom-checkbox input:checked + div { background-color: #0F766E; border-color: #0F766E; }',
                '        .custom-checkbox input:checked + div:after { content: "âœ“"; color: white; display: block; text-align: center; line-height: 20px; font-size: 14px; }',
                '    </style>',
                '</head>',
                '<body class="bg-vn-bg text-gray-700 h-screen flex flex-col max-w-md mx-auto shadow-2xl relative overflow-hidden dark:bg-gray-900 dark:text-gray-200 transition-colors duration-300">',
                '',
                '    <div id="app-header" class="fixed top-0 w-full max-w-md z-50 bg-vn-bg dark:bg-gray-900 transition-colors duration-300 shadow-sm">',
                '        <div class="bamboo-weave pt-8 pb-4 px-6 text-white relative overflow-hidden">',
                '             <div class="absolute top-0 right-0 w-40 h-40 bg-white opacity-10 rounded-full -mr-10 -mt-10 blur-2xl"></div>',
                '             <div class="absolute bottom-0 left-0 w-20 h-20 bg-teal-300 opacity-20 rounded-full -ml-5 -mb-5 blur-xl"></div>',
                '            <div class="flex justify-between items-end relative z-10">',
                '                <div>',
                '                    <p class="text-[10px] font-bold tracking-[0.2em] opacity-80 uppercase mb-1 text-teal-100">è¡Œå‹•èªªæ˜æœƒ(æ¸¬è©¦ä¸­)</p>',
                `                    <h1 class="text-xl font-bold leading-tight text-white shadow-sm">${data.tripName}</h1>`,
                '                    <p class="text-xs opacity-90 mt-1 font-light flex items-center gap-2 text-white">',
                `                        <span><i class="far fa-calendar-alt mr-1"></i> ${data.meeting.date} å‡ºç™¼</span>`,
                `                        <span class="bg-white/20 px-2 py-0.5 rounded text-[10px]">${data.tripCode}</span>`,
                '                    </p>',
                '                </div>',
                '                <div class="text-right text-white">',
                '                     <div id="location-label" class="text-[10px] opacity-80 mb-1"><i class="fas fa-map-marker-alt mr-1"></i>åµæ¸¬ä¸­...</div>',
                '                     <div id="header-weather" class="text-2xl font-light">--<span class="text-sm">Â°C</span></div>',
                '                </div>',
                '            </div>',
                '        </div>',
                '        <nav class="flex justify-around border-b border-gray-100 dark:border-gray-700 bg-white dark:bg-vn-card-dark">',
                '            <button onclick="switchTab(\'itinerary\')" id="btn-itinerary" class="flex-1 py-3 text-sm tab-active transition-all"><i class="fas fa-map-signs mr-1"></i> è¡Œç¨‹</button>',
                '            <button onclick="switchTab(\'info\')" id="btn-info" class="flex-1 py-3 text-sm tab-inactive transition-all"><i class="fas fa-info-circle mr-1"></i> è³‡è¨Š</button>',
                '            <button onclick="switchTab(\'tools\')" id="btn-tools" class="flex-1 py-3 text-sm tab-inactive transition-all"><i class="fas fa-suitcase mr-1"></i> å·¥å…·</button>',
                '        </nav>',
                '    </div>',
                '',
                '    <main class="flex-1 overflow-y-auto no-scrollbar pb-10 px-4" id="main-content">',
                '        ',
                '        <div id="view-itinerary" class="space-y-4 pb-10">',
                '            ',
                '            <div class="bg-white dark:bg-vn-card-dark rounded-xl p-4 shadow-sm border-l-4 border-vn-primary relative overflow-hidden card-shadow">',
                '                <div class="flex justify-between items-start mb-3">',
                '                    <div class="flex-1">',
                '                        <h3 class="text-sm font-bold text-gray-800 dark:text-gray-100 mb-2 flex items-center gap-2"><i class="far fa-clock text-vn-primary"></i> é›†åˆè³‡è¨Š</h3>',
                '                        <div class="flex gap-4">',
                '                            <div>',
                '                                <p class="text-[10px] text-gray-400">é›†åˆæ™‚é–“</p>',
                `                                <p class="text-xl font-bold text-vn-primary">${data.meeting.time}</p>`,
                '                            </div>',
                '                        </div>',
                '                        <div class="mt-2">',
                '                            <p class="text-[10px] text-gray-400">é›†åˆåœ°é»</p>',
                `                            <p class="text-sm text-gray-600 dark:text-gray-300 leading-tight font-medium whitespace-pre-wrap">${data.meeting.location}</p>`,
                '                        </div>',
                '                         <div class="mt-2">',
                '                            <p class="text-[10px] text-gray-400">è­˜åˆ¥ç‰Œ</p>',
                `                            <span class="inline-block ${badgeColorClass} text-white text-xs px-2 py-0.5 rounded shadow-sm">${data.meeting.badge}</span>`,
                '                        </div>',
                '                    </div>',
                hasLeader ? `
                    <div class="text-right pl-2 border-l border-dashed border-gray-200 dark:border-gray-600 flex flex-col items-center justify-center min-w-[70px]">
                        <p class="text-[10px] text-gray-400 mb-1">é ˜éšŠ ${data.guide.name}</p>
                        <button onclick="callGuide('${data.guide.twPhone}')" class="flex flex-col items-center justify-center w-12 h-12 bg-vn-primary text-white rounded-full shadow-lg active:scale-95 transition-transform"><i class="fas fa-phone text-xl"></i></button>
                        <p class="text-[10px] text-gray-500 mt-1">${data.guide.twPhone}</p>
                    </div>` : '',
                '                </div>',
                data.meeting.airportStaff ? `                <div class="pt-2 border-t border-dashed border-gray-200 dark:border-gray-600 text-xs text-gray-500 dark:text-gray-400 flex justify-between"><span>æ©Ÿå ´å°ˆå“¡</span><span>${data.meeting.airportStaff}</span></div>` : '',
                '            </div>',
                '',
                data.days.map((day, idx) => `
                <div class="bg-white dark:bg-vn-card-dark rounded-xl shadow-sm overflow-hidden p-5 transition-colors card-shadow">
                    <div class="flex justify-between items-start mb-3 border-b border-gray-100 dark:border-gray-700 pb-2">
                        <div>
                            <h2 class="font-bold text-lg text-vn-primary dark:text-teal-400">DAY ${day.day} <span class="text-xs font-normal text-gray-400 ml-2">${day.date}</span></h2>
                            <div id="weather-stats-${idx}" class="mt-2 flex flex-wrap gap-y-2"><span class="text-xs text-gray-400">è¼‰å…¥ä¸­...</span></div>
                        </div>
                        <div id="weather-icon-${idx}" class="text-2xl text-gray-300"></div>
                    </div>

                    <div class="space-y-4 relative pl-4 border-l-2 border-gray-100 dark:border-gray-600 pb-2 pt-2">
                        <p class="text-[10px] text-gray-400 absolute -top-2 left-2 bg-white dark:bg-vn-card-dark px-1">${day.location || 'è¡Œç¨‹'}</p>
                        
                        ${day.spots.map((spot, sIdx) => `
                        <div class="relative cursor-pointer group" onclick="toggleDetail(this)">
                            <div class="absolute -left-[21px] top-1 w-3 h-3 ${sIdx % 2 === 0 ? 'bg-vn-primary' : 'bg-vn-accent'} rounded-full border-2 border-white dark:border-gray-600"></div>
                            <div class="flex justify-between items-center">
                                <h3 class="font-bold text-gray-800 dark:text-gray-100 text-sm leading-tight">${spot.name}</h3>
                                <i class="fas fa-chevron-down text-xs text-gray-300 transition-transform duration-300 mt-1"></i>
                            </div>
                            <div class="detail-content hidden mt-2 text-sm text-gray-600 dark:text-gray-300 bg-gray-50 dark:bg-gray-700/50 p-3 rounded-lg leading-relaxed text-justify">
                                ${spot.desc || 'ç„¡è©³ç´°ä»‹ç´¹'}
                            </div>
                        </div>
                        `).join('')}

                        <div class="relative cursor-pointer" onclick="${day.hotelAddress ? `showHotelCard('${day.hotel}', '${day.hotelTel}', '${day.hotelAddress}', 'Day ${day.day}')` : ''}">
                            <div class="absolute -left-[21px] top-1 w-3 h-3 bg-purple-400 rounded-full border-2 border-white dark:border-gray-600"></div>
                            <div class="flex justify-between items-center">
                                <h3 class="font-bold text-gray-800 dark:text-gray-100 text-sm"><i class="fas fa-bed text-purple-400 mr-1"></i> ${day.hotel}</h3>
                                ${day.hotelAddress ? '<i class="fas fa-search-plus text-gray-300 text-xs"></i>' : ''}
                            </div>
                            <p class="text-[10px] text-gray-400 pl-5 mt-1">${day.hotel.includes('æº«æš–çš„å®¶') ? '' : `TEL: ${day.hotelTel || 'è©³æ´½é ˜éšŠ'}`}</p>
                        </div>
                    </div>

                    <div class="mt-3 bg-gray-50 dark:bg-gray-700 rounded-lg p-3 text-sm text-gray-600 dark:text-gray-300 space-y-1">
                        <div class="flex"><span class="w-8 font-bold text-gray-400 text-xs pt-0.5">æ—©é¤</span> <span class="flex-1">${day.meals.b}</span></div>
                        <div class="flex"><span class="w-8 font-bold text-gray-400 text-xs pt-0.5">åˆé¤</span> <span class="flex-1">${day.meals.l}</span></div>
                        <div class="flex"><span class="w-8 font-bold text-gray-400 text-xs pt-0.5">æ™šé¤</span> <span class="flex-1">${day.meals.d}</span></div>
                    </div>
                </div>
                `).join(''),
                '            <div class="text-center text-xs text-gray-400 py-4 pb-20">æœ¬ç¶²é æ¸¬è©¦ä¸­ï¼Œå¦‚æœ‰å‹˜èª¤è«‹ä¾ç…§ç´™æœ¬èªªæ˜æœƒè³‡æ–™ç‚ºæº–<br>ç¥æ‚¨æ—…é€”æ„‰å¿« Have a Nice Trip</div>',
                '        </div>',
                '',
                '        <div id="view-info" class="hidden space-y-4 pb-10">',
                '            <div class="bg-white dark:bg-vn-card-dark rounded-xl p-5 card-shadow transition-colors border-l-4 border-yellow-500">',
                '                <h3 class="font-bold text-gray-800 dark:text-gray-100 mb-2"><i class="fas fa-hand-holding-usd text-yellow-500 mr-2"></i>æœå‹™è²»èªªæ˜</h3>',
                '                <p class="text-sm text-gray-600 dark:text-gray-300 leading-relaxed">',
                `                    æœ¬è¡Œç¨‹${tipTitleText}æœå‹™è²»ï¼Œæ¯ä½æ—…å®¢æ¯å¤© <span class="font-bold text-vn-primary">${data.info.tips.currency} ${data.info.tips.perDay} å…ƒ</span>ï¼Œ`,
                `                    ${data.info.tips.days} å¤©å…± <span class="font-bold text-vn-primary">${data.info.tips.currency} ${totalTips} å…ƒ</span>ï¼Œ`,
                `                    è«‹æ–¼è¡Œç¨‹ä¸­æ”¯ä»˜çµ¦${tipPayText}ã€‚`,
                '                </p>',
                '            </div>',
                '',
                '            <div class="bg-white dark:bg-vn-card-dark rounded-xl p-5 card-shadow transition-colors">',
                '                <h3 class="font-bold text-gray-800 dark:text-gray-100 mb-3 border-l-4 border-orange-400 pl-3">èˆªç­è³‡è¨Š</h3>',
                data.flights.map(f => `
                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-3 mb-2">
                    <div class="flex justify-between text-sm mb-1 text-gray-600 dark:text-gray-300">
                        <span class="font-bold">${f.type} ${f.code}</span><span>${f.date}</span>
                    </div>
                    <div class="grid grid-cols-[1fr_auto_1fr] items-center text-gray-800 dark:text-white">
                        <div><div class="text-xl font-bold">${f.depTime}</div><div class="text-xs opacity-60">${f.depAirport}</div></div>
                        <div class="text-center"><i class="fas fa-arrow-right opacity-40"></i></div>
                        <div class="text-right"><div class="text-xl font-bold">${f.arrTime}</div><div class="text-xs opacity-60">${f.arrAirport}</div></div>
                    </div>
                </div>`).join(''),
                '            </div>',
                '',
                '            <!-- ä½å®¿è³‡è¨Šå¡ç‰‡ -->',
                '            <div class="bg-white dark:bg-vn-card-dark rounded-xl p-5 card-shadow transition-colors">',
                '                <h3 class="font-bold text-gray-800 dark:text-gray-100 mb-3"><i class="fas fa-hotel text-vn-primary mr-2"></i>ä½å®¿è³‡è¨Š</h3>',
                '                <ul class="text-sm space-y-3 dark:text-gray-300">',
                data.days.map(d => `
                    <li class="flex justify-between border-b border-gray-50 dark:border-gray-700 pb-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/50 p-1 rounded" onclick="${d.hotelAddress ? `showHotelCard('${d.hotel}', '${d.hotelTel}', '${d.hotelAddress}', 'Day ${d.day}')` : ''}">
                        <span class="text-vn-primary dark:text-teal-400 font-bold">Day ${d.day} ${d.hotelAddress ? '<i class="fas fa-search-plus text-xs ml-1 opacity-50"></i>' : ''}</span>
                        <span class="font-medium text-right">${d.hotel}<br><span class="text-xs text-gray-400">${d.hotel.includes('æº«æš–çš„å®¶') ? '' : d.hotelTel || 'è©³æ´½é ˜éšŠ'}</span></span>
                    </li>`).join(''),
                '                </ul>',
                showDriverCardHint ? '<p class="text-[10px] text-gray-400 mt-2 text-right">* é»æ“Šé£¯åº—å¯é¡¯ç¤ºçµ¦å¸æ©Ÿçœ‹çš„å¡ç‰‡</p>' : '',
                '            </div>',
                '',
                '            <div class="space-y-3">',
                '                <div class="bg-orange-50 dark:bg-orange-900/20 p-4 rounded-xl">',
                '                    <i class="fas fa-sun text-orange-500 text-xl mb-2"></i>',
                '                    <h4 class="font-bold text-sm text-gray-700 dark:text-gray-200">å¤©æ°£ç©¿è‘—</h4>',
                `                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1 leading-relaxed">${data.info.weather}</p>`,
                '                </div>',
                '                <div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-xl">',
                '                    <i class="fas fa-money-bill-wave text-green-500 text-xl mb-2"></i>',
                '                    <h4 class="font-bold text-sm text-gray-700 dark:text-gray-200">è²¨å¹£åŒ¯ç‡</h4>',
                `                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1 leading-relaxed">${data.info.currency}</p>`,
                '                </div>',
                '                <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl">',
                '                    <h4 class="font-bold text-sm text-gray-700 dark:text-gray-200 mb-1"><i class="fas fa-suitcase text-blue-500 mr-2"></i>è¡Œæèˆ‡é ˆçŸ¥</h4>',
                `                    <p class="text-xs text-gray-500 dark:text-gray-400 leading-relaxed">${data.info.baggage}</p>`,
                '                </div>',
                '            </div>',
                '',
                imageList.length > 0 ? `
                <div class="bg-white dark:bg-vn-card-dark rounded-xl p-5 card-shadow transition-colors mt-4">
                    <h3 class="font-bold text-gray-800 dark:text-gray-100 mb-3"><i class="fas fa-images text-pink-500 mr-2"></i>æ³¨æ„äº‹é …</h3>
                    <div class="grid grid-cols-1 gap-2">
                        ${imageList.map(url => `<img src="${url}" onerror="this.style.display='none'" class="w-full h-auto object-contain rounded-lg shadow-sm">`).join('')}
                    </div>
                </div>` : '',
                '',
                data.info.pdfPath ? `
                <a href="${data.info.pdfPath}" target="_blank" class="block w-full bg-gray-800 hover:bg-gray-700 text-white text-center py-3 rounded-xl font-bold mt-6 shadow-md transition">
                    <i class="fas fa-file-pdf mr-2"></i> ä¸‹è¼‰ç´™æœ¬èªªæ˜æœƒè³‡æ–™
                </a>` : '',
                data.info.surveyUrl ? `
                <a href="${data.info.surveyUrl}" target="_blank" class="block w-full bg-teal-600 hover:bg-teal-700 text-white text-center py-3 rounded-xl font-bold mt-6 shadow-md transition">
                    <i class="fas fa-smile mr-2"></i> å¡«å¯«å®¢æˆ¶æ»¿æ„åº¦èª¿æŸ¥
                </a>` : '',
                '            <div class="text-center text-xs text-gray-400 py-4 pb-20">æœ¬ç¶²é æ¸¬è©¦ä¸­ï¼Œå¦‚æœ‰å‹˜èª¤è«‹ä¾ç…§ç´™æœ¬èªªæ˜æœƒè³‡æ–™ç‚ºæº–<br>ç¥æ‚¨æ—…é€”æ„‰å¿« Have a Nice Trip</div>',
                '        </div>',
                '',
                '        <div id="view-tools" class="hidden space-y-6 pb-10">',
                '            ',
                '            <div class="bg-white dark:bg-vn-card-dark rounded-xl p-5 card-shadow transition-colors">',
                '                <h3 class="font-bold text-gray-800 dark:text-gray-100 mb-3"><i class="fas fa-tasks text-teal-500 mr-2"></i>æ—…äººæª¢æŸ¥æ¸…å–®</h3>',
                '                <div class="space-y-4">',
                '                    <div>',
                '                        <p class="text-xs text-gray-400 mb-2 font-bold uppercase tracking-wider bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-300 px-2 py-1 rounded inline-block">é‡è¦æ–‡ä»¶</p>',
                '                        <div class="grid grid-cols-2 gap-2">',
                '                            <label class="flex items-center space-x-2 cursor-pointer custom-checkbox">',
                '                                <input type="checkbox" id="check_doc_passport" class="hidden" onchange="saveCheck(this.id)">',
                '                                <div class="w-4 h-4 border-2 border-gray-300 rounded flex items-center justify-center transition-colors"></div>',
                '                                <span class="text-sm text-gray-600 dark:text-gray-300">è­·ç…§<br>å¤§é ­ç…§å…©å¼µ</span>',
                '                            </label>',
                '                            <label class="flex items-center space-x-2 cursor-pointer custom-checkbox">',
                '                                <input type="checkbox" id="check_doc_money" class="hidden" onchange="saveCheck(this.id)">',
                '                                <div class="w-4 h-4 border-2 border-gray-300 rounded flex items-center justify-center transition-colors"></div>',
                '                                <span class="text-sm text-gray-600 dark:text-gray-300">å°å¹£ç¾éˆ”<br>(å°éŠå¯æ›è¶Šç›¾)</span>',
                '                            </label>',
                '                            <label class="flex items-center space-x-2 cursor-pointer custom-checkbox">',
                '                                <input type="checkbox" id="check_doc_card" class="hidden" onchange="saveCheck(this.id)">',
                '                                <div class="w-4 h-4 border-2 border-gray-300 rounded flex items-center justify-center transition-colors"></div>',
                '                                <span class="text-sm text-gray-600 dark:text-gray-300">ä¿¡ç”¨å¡</span>',
                '                            </label>',
                '                            <label class="flex items-center space-x-2 cursor-pointer custom-checkbox">',
                '                                <input type="checkbox" id="check_doc_ticket" class="hidden" onchange="saveCheck(this.id)">',
                '                                <div class="w-4 h-4 border-2 border-gray-300 rounded flex items-center justify-center transition-colors"></div>',
                '                                <span class="text-sm text-gray-600 dark:text-gray-300">æ—…éŠä¿éšª</span>',
                '                            </label>',
                '                        </div>',
                '                    </div>',
                '                    <div>',
                '                        <p class="text-xs text-gray-400 mb-2 font-bold uppercase tracking-wider bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-300 px-2 py-1 rounded inline-block">3C ç”¢å“</p>',
                '                        <div class="grid grid-cols-2 gap-2">',
                '                            <label class="flex items-center space-x-2 cursor-pointer custom-checkbox">',
                '                                <input type="checkbox" id="check_3c_phone" class="hidden" onchange="saveCheck(this.id)">',
                '                                <div class="w-4 h-4 border-2 border-gray-300 rounded flex items-center justify-center transition-colors"></div>',
                '                                <span class="text-sm text-gray-600 dark:text-gray-300">ç¶²å¡/æ¼«éŠ</span>',
                '                            </label>',
                '                            <label class="flex items-center space-x-2 cursor-pointer custom-checkbox">',
                '                                <input type="checkbox" id="check_3c_charge" class="hidden" onchange="saveCheck(this.id)">',
                '                                <div class="w-4 h-4 border-2 border-gray-300 rounded flex items-center justify-center transition-colors"></div>',
                '                                <span class="text-sm text-gray-600 dark:text-gray-300">å……é›»å™¨</span>',
                '                            </label>',
                '                            <label class="flex items-center space-x-2 cursor-pointer custom-checkbox">',
                '                                <input type="checkbox" id="check_3c_bank" class="hidden" onchange="saveCheck(this.id)">',
                '                                <div class="w-4 h-4 border-2 border-gray-300 rounded flex items-center justify-center transition-colors"></div>',
                '                                <span class="text-sm text-gray-600 dark:text-gray-300">è¡Œå‹•é›»æº</span>',
                '                            </label>',
                '                        </div>',
                '                        <div class="mt-2 text-[10px] text-yellow-600 bg-yellow-50 dark:bg-yellow-900/20 dark:text-yellow-400 p-2 rounded">',
                '                            âš¡ è¶Šå—é›»å£“ 220Vï¼Œæ’åº§å¤šç‚ºé›™å­”åœ“/æ‰é€šç”¨ã€‚',
                '                        </div>',
                '                    </div>',
                '                    <div>',
                '                        <p class="text-xs text-gray-400 mb-2 font-bold uppercase tracking-wider bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-300 px-2 py-1 rounded inline-block">å€‹äºº / ç›¥æ´— / è—¥å“</p>',
                '                        <div class="grid grid-cols-2 gap-2">',
                '                            <label class="flex items-center space-x-2 cursor-pointer custom-checkbox">',
                '                                <input type="checkbox" id="check_item_rain" class="hidden" onchange="saveCheck(this.id)">',
                '                                <div class="w-4 h-4 border-2 border-gray-300 rounded flex items-center justify-center transition-colors"></div>',
                '                                <span class="text-sm text-gray-600 dark:text-gray-300">é›¨å…·/é®é™½å¸½</span>',
                '                            </label>',
                '                            <label class="flex items-center space-x-2 cursor-pointer custom-checkbox">',
                '                                <input type="checkbox" id="check_item_coat" class="hidden" onchange="saveCheck(this.id)">',
                '                                <div class="w-4 h-4 border-2 border-gray-300 rounded flex items-center justify-center transition-colors"></div>',
                '                                <span class="text-sm text-gray-600 dark:text-gray-300">è–„å¤–å¥—<br>(è»Šä¸Šå†·æ°£è¼ƒå¼·)</span>',
                '                            </label>',
                '                            <label class="flex items-center space-x-2 cursor-pointer custom-checkbox">',
                '                                <input type="checkbox" id="check_item_wash" class="hidden" onchange="saveCheck(this.id)">',
                '                                <div class="w-4 h-4 border-2 border-gray-300 rounded flex items-center justify-center transition-colors"></div>',
                '                                <span class="text-sm text-gray-600 dark:text-gray-300">ç‰™åˆ·/æ´—é¢ä¹³</span>',
                '                            </label>',
                '                            <label class="flex items-center space-x-2 cursor-pointer custom-checkbox">',
                '                                <input type="checkbox" id="check_item_meds" class="hidden" onchange="saveCheck(this.id)">',
                '                                <div class="w-4 h-4 border-2 border-gray-300 rounded flex items-center justify-center transition-colors"></div>',
                '                                <span class="text-sm text-gray-600 dark:text-gray-300">å€‹äººå¸¸å‚™è—¥å“</span>',
                '                            </label>',
                '                        </div>',
                '                    </div>',
                '                </div>',
                '                <div class="mt-6 pt-4 border-t border-gray-100 dark:border-gray-700">',
                '                    <p class="text-xs text-gray-400 mb-2 font-bold uppercase tracking-wider">æ¯æ—¥é€€æˆ¿æª¢æŸ¥ (é˜²æ­¢éºè½)</p>',
                '                    <div class="space-y-2">',
                '                        <label class="flex items-center space-x-3 cursor-pointer custom-checkbox">',
                '                            <input type="checkbox" id="daily_charger" class="hidden" onchange="saveCheck(this.id)">',
                '                            <div class="w-5 h-5 border-2 border-gray-300 rounded flex items-center justify-center transition-colors"></div>',
                '                            <span class="text-sm text-gray-600 dark:text-gray-300">å……é›»å™¨/è¡Œå‹•é›»æº</span>',
                '                        </label>',
                '                        <label class="flex items-center space-x-3 cursor-pointer custom-checkbox">',
                '                            <input type="checkbox" id="daily_wash" class="hidden" onchange="saveCheck(this.id)">',
                '                            <div class="w-5 h-5 border-2 border-gray-300 rounded flex items-center justify-center transition-colors"></div>',
                '                            <span class="text-sm text-gray-600 dark:text-gray-300">ç›¥æ´—åŒ…/çœ¼é¡/éš±çœ¼/å‡ç‰™</span>',
                '                        </label>',
                '                        <label class="flex items-center space-x-3 cursor-pointer custom-checkbox">',
                '                            <input type="checkbox" id="daily_wifi" class="hidden" onchange="saveCheck(this.id)">',
                '                            <div class="w-5 h-5 border-2 border-gray-300 rounded flex items-center justify-center transition-colors"></div>',
                '                            <span class="text-sm text-gray-600 dark:text-gray-300">è­·ç…§/éš¨èº«è²´é‡ç‰©å“</span>',
                '                        </label>',
                '                        <label class="flex items-center space-x-3 cursor-pointer custom-checkbox">',
                '                            <input type="checkbox" id="daily_key" class="hidden" onchange="saveCheck(this.id)">',
                '                            <div class="w-5 h-5 border-2 border-gray-300 rounded flex items-center justify-center transition-colors"></div>',
                '                            <span class="text-sm text-gray-600 dark:text-gray-300">æˆ¿å¡å·²æ­¸é‚„</span>',
                '                        </label>',
                '                    </div>',
                '                    <button onclick="resetDailyChecks()" class="mt-3 text-xs text-blue-400 underline w-full text-right">é‡ç½®æ¯æ—¥æª¢æŸ¥</button>',
                '                </div>',
                '            </div>',
                '',
                '            <!-- æ‰‹æŒ‡è¶Šèª (ç©ºè€³å­—å¹•å¢å¼·ç‰ˆ) -->',
                '            <div class="bg-white dark:bg-vn-card-dark rounded-xl p-5 card-shadow transition-colors">',
                '                <h3 class="font-bold text-gray-800 dark:text-gray-100 mb-3">',
                '                    <i class="fas fa-language text-vn-primary mr-2"></i>æ‰‹æŒ‡è¶Šèª',
                '                </h3>',
                '                ',
                '                <p class="text-xs text-gray-400 mb-2 mt-1 font-bold">åŸºç¤æœƒè©±</p>',
                '                <div class="grid grid-cols-2 gap-3 mb-4">',
                '                    <button onclick="speakVn(\'Xin chÃ o\')" class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg text-left active:bg-gray-200 dark:active:bg-gray-600 transition">',
                '                        <div class="text-xs text-gray-400">ä½ å¥½</div>',
                '                        <div class="font-bold text-vn-primary dark:text-teal-400">Xin chÃ o</div>',
                '                        <div class="text-[10px] text-gray-400">/è¾›æ—©/</div>',
                '                    </button>',
                '                    <button onclick="speakVn(\'Cáº£m Æ¡n\')" class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg text-left active:bg-gray-200 dark:active:bg-gray-600 transition">',
                '                        <div class="text-xs text-gray-400">è¬è¬</div>',
                '                        <div class="font-bold text-vn-primary dark:text-teal-400">Cáº£m Æ¡n</div>',
                '                         <div class="text-[10px] text-gray-400">/æ„Ÿæ©/</div>',
                '                    </button>',
                '                    <button onclick="speakVn(\'PhÃ²ng táº¯m á»Ÿ Ä‘Ã¢u?\')" class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg text-left active:bg-gray-200 dark:active:bg-gray-600 transition">',
                '                        <div class="text-xs text-gray-400">å»æ‰€åœ¨å“ªè£¡</div>',
                '                        <div class="font-bold text-vn-primary dark:text-teal-400">Toilet?</div>',
                '                        <div class="text-[10px] text-gray-400">/è«·èƒ†å¶æ‘Ÿ?/</div>',
                '                    </button>',
                '                </div>',
                '',
                '                <p class="text-xs text-gray-400 mb-2 mt-1 font-bold">ğŸ’° è³¼ç‰©æ®ºåƒ¹</p>',
                '                <div class="grid grid-cols-2 gap-3 mb-4">',
                '                     <button onclick="speakVn(\'CÃ¡i nÃ y bao nhiÃªu tiá»n?\')" class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg text-left active:bg-gray-200 dark:active:bg-gray-600 transition">',
                '                        <div class="text-xs text-gray-400">å¤šå°‘éŒ¢?</div>',
                '                        <div class="font-bold text-vn-primary dark:text-teal-400">Bao nhiÃªu?</div>',
                '                        <div class="text-[10px] text-gray-400">/æ”¹å¥¶åŒ…ç´é»?/</div>',
                '                    </button>',
                '                    <button onclick="speakVn(\'Äáº¯t quÃ¡\')" class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg text-left active:bg-gray-200 dark:active:bg-gray-600 transition">',
                '                        <div class="text-xs text-gray-400">å¤ªè²´äº†</div>',
                '                        <div class="font-bold text-vn-primary dark:text-teal-400">Äáº¯t quÃ¡</div>',
                '                        <div class="text-[10px] text-gray-400">/é‚£ç“œ/</div>',
                '                    </button>',
                '                    <button onclick="speakVn(\'Giáº£m giÃ¡ Ä‘i\')" class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg text-left active:bg-gray-200 dark:active:bg-gray-600 transition">',
                '                        <div class="text-xs text-gray-400">ä¾¿å®œä¸€é»</div>',
                '                        <div class="font-bold text-vn-primary dark:text-teal-400">Giáº£m giÃ¡ Ä‘i</div>',
                '                        <div class="text-[10px] text-gray-400">/è®šæ‰å“©/</div>',
                '                    </button>',
                '                    <button onclick="speakVn(\'TÃ´i muá»‘n cÃ¡i nÃ y\')" class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg text-left active:bg-gray-200 dark:active:bg-gray-600 transition">',
                '                        <div class="text-xs text-gray-400">æˆ‘è¦é€™å€‹</div>',
                '                        <div class="font-bold text-vn-primary dark:text-teal-400">TÃ´i muá»‘n cÃ¡i nÃ y</div>',
                '                        <div class="text-[10px] text-gray-400">/å †é–€æ”¹å¥¶/</div>',
                '                    </button>',
                '                </div>',
                '',
                '                <p class="text-xs text-gray-400 mb-2 mt-1 font-bold">ğŸ½ï¸ ç”¨é¤</p>',
                '                <div class="grid grid-cols-2 gap-3">',
                '                    <button onclick="speakVn(\'TÃ­nh tiá»n\')" class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg text-left active:bg-gray-200 dark:active:bg-gray-600 transition">',
                '                        <div class="text-xs text-gray-400">è²·å–®</div>',
                '                        <div class="font-bold text-vn-primary dark:text-teal-400">TÃ­nh tiá»n</div>',
                '                        <div class="text-[10px] text-gray-400">/é ‚é»/</div>',
                '                    </button>',
                '                    <button onclick="speakVn(\'Ngon láº¯m\')" class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg text-left active:bg-gray-200 dark:active:bg-gray-600 transition">',
                '                        <div class="text-xs text-gray-400">å¥½åƒ</div>',
                '                        <div class="font-bold text-vn-primary dark:text-teal-400">Ngon láº¯m</div>',
                '                        <div class="text-[10px] text-gray-400">/å¼„éƒ/</div>',
                '                    </button>',
                '                    <button onclick="speakVn(\'KhÃ´ng Äƒn rau mÃ¹i\')" class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg text-left active:bg-gray-200 dark:active:bg-gray-600 transition">',
                '                        <div class="text-xs text-gray-400">ä¸è¦é¦™èœ</div>',
                '                        <div class="font-bold text-vn-primary dark:text-teal-400 text-sm">KhÃ´ng rau mÃ¹i</div>',
                '                        <div class="text-[10px] text-gray-400">/ç©ºå®‰æ‹›æ²’/</div>',
                '                    </button>',
                '                </div>',
                '',
                '                <div id="speak-status" class="text-center text-xs text-gray-400 mt-2 h-4"></div>',
                '            </div>',
                '',
                '            <!-- ç·Šæ€¥è¯çµ¡ -->',
                '            <div class="bg-white dark:bg-vn-card-dark rounded-xl p-5 card-shadow transition-colors">',
                '                <h3 class="font-bold text-gray-800 dark:text-gray-100 mb-4"><i class="fas fa-exclamation-circle text-vn-primary mr-2"></i>ç·Šæ€¥è¯çµ¡ & æ”¯æ´</h3>',
                '                ',
                '                <div class="grid grid-cols-3 gap-3 mb-3">',
                '                    <a href="tel:113" class="border border-gray-200 dark:border-gray-600 rounded-xl p-2 text-center active:bg-gray-50 dark:active:bg-gray-700">',
                '                        <div class="text-[10px] text-gray-400 mb-1">è­¦å¯Ÿ</div>',
                '                        <div class="text-2xl font-bold text-vn-primary">113</div>',
                '                    </a>',
                '                    <a href="tel:115" class="border border-gray-200 dark:border-gray-600 rounded-xl p-2 text-center active:bg-gray-50 dark:active:bg-gray-700">',
                '                        <div class="text-[10px] text-gray-400 mb-1">æ•‘è­·</div>',
                '                        <div class="text-2xl font-bold text-vn-primary">115</div>',
                '                    </a>',
                '                    <a href="tel:114" class="border border-gray-200 dark:border-gray-600 rounded-xl p-2 text-center active:bg-gray-50 dark:active:bg-gray-700">',
                '                        <div class="text-[10px] text-gray-400 mb-1">ç«è­¦</div>',
                '                        <div class="text-2xl font-bold text-vn-primary">114</div>',
                '                    </a>',
                '                </div>',
                '',
                '                <div class="space-y-3 pt-3 border-t border-gray-100 dark:border-gray-700">',
                '                    <p class="text-xs text-gray-400 font-bold">åœ˜é«”å°ˆå±¬è¯çµ¡äºº</p>',
                hasLeader ? `
                    <div onclick="callGuide('${data.guide.twPhone}')" class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg cursor-pointer">
                        <div><p class="font-bold text-sm dark:text-gray-200">é ˜éšŠ ${data.guide.name}</p><p class="text-xs text-gray-400">${data.guide.twPhone}</p></div>
                        <div class="w-8 h-8 bg-green-100 text-green-600 rounded-full flex items-center justify-center"><i class="fas fa-phone"></i></div>
                    </div>` : '',
                `                    <a href="tel:${data.meeting.airportStaff ? data.meeting.airportStaff.split(' ').pop() : ''}" class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                        <div><p class="font-bold text-sm dark:text-gray-200">æ©Ÿå ´å°ˆå“¡</p><p class="text-xs text-gray-400">${data.meeting.airportStaff || 'ç„¡è³‡è¨Š'}</p></div>
                                        <div class="w-8 h-8 bg-green-100 text-green-600 rounded-full flex items-center justify-center"><i class="fas fa-phone"></i></div>
                                    </a>`,
                '                    <div class="p-3 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-100 dark:border-red-900">',
                '                        <p class="text-xs text-red-600 dark:text-red-400 font-bold mb-1">é§è¶Šå—å°åŒ—ç¶“æ¿Ÿæ–‡åŒ–è¾¦äº‹è™• (æ²³å…§)</p>',
                '                        <a href="tel:+84913219986" class="block text-sm font-bold text-red-600">091-321-9986 (æ€¥é›£æ•‘åŠ©)</a>',
                '                        <hr class="border-red-200 my-2">',
                '                        <p class="text-xs text-red-600 dark:text-red-400 font-bold mb-1">é§èƒ¡å¿—æ˜å¸‚å°åŒ—ç¶“æ¿Ÿæ–‡åŒ–è¾¦äº‹è™•</p>',
                '                        <a href="tel:+84903927019" class="block text-sm font-bold text-red-600">090-392-7019 (æ€¥é›£æ•‘åŠ©)</a>',
                '                    </div>',
                '                </div>',
                '            </div>',
                '',
                '            <!-- åŒ¯ç‡æ›ç®— -->',
                '            <div class="bg-white dark:bg-vn-card-dark rounded-xl p-5 card-shadow transition-colors">',
                '                <h3 class="font-bold text-gray-800 dark:text-gray-100 mb-3"><i class="fas fa-coins text-yellow-500 mr-2"></i>å³æ™‚åŒ¯ç‡æ›ç®— (VND/TWD)</h3>',
                '                <div class="flex items-center space-x-2 bg-gray-50 dark:bg-gray-700 p-4 rounded-xl">',
                '                    <div class="flex-1"><label class="text-xs text-gray-400 block mb-1">è¶Šå—ç›¾ (VND)</label><input type="number" id="calc-vnd" placeholder="è¼¸å…¥" class="w-full bg-transparent text-lg font-bold text-gray-700 dark:text-white outline-none" oninput="convertCurrency()"></div>',
                '                    <i class="fas fa-arrow-right text-gray-300"></i>',
                '                    <div class="flex-1 text-right"><label class="text-xs text-gray-400 block mb-1">å°å¹£ (TWD)</label><div id="calc-twd" class="text-lg font-bold text-blue-500">0</div></div>',
                '                </div>',
                '                <p class="text-[10px] text-gray-400 mt-2 text-right">åŒ¯ç‡åƒè€ƒ: 1 VND â‰ˆ <span id="calc-rate-display">...</span> TWD</p>',
                '            </div>',
                '',
                '            <!-- H. è³¼ç‰©è¨˜å¸³ -->',
                '            <div class="bg-white dark:bg-vn-card-dark rounded-xl p-5 card-shadow transition-colors">',
                '                <div class="flex justify-between items-center mb-3"><h3 class="font-bold text-gray-800 dark:text-gray-100"><i class="fas fa-shopping-bag text-yellow-400 mr-2"></i>è³¼ç‰©è¨˜å¸³ (ç¸½è¡¨)</h3><button onclick="resetBudget()" class="text-xs text-red-400 underline">é‡ç½®</button></div>',
                '                ',
                '                <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-xl mb-4 text-center">',
                '                    <p class="text-xs text-gray-400">ç¸½èŠ±è²» (VND)</p><p class="text-2xl font-bold text-gray-800 dark:text-white" id="total-amount">â‚«0</p>',
                '                    <p class="text-xs text-gray-400 mt-1">ç´„å°å¹£ NT$ <span id="twd-amount">0</span></p>',
                '                </div>',
                '',
                '                <div class="flex gap-1 mb-4">',
                '                    <input type="text" id="item-name" placeholder="å–®ç­†å“é …" class="flex-[2] min-w-0 bg-gray-100 dark:bg-gray-700 dark:text-white border-none rounded-lg text-sm px-2 py-2 outline-none">',
                '                    <input type="number" id="item-qty" placeholder="x1" class="w-10 bg-gray-100 dark:bg-gray-700 dark:text-white border-none rounded-lg text-sm px-1 py-2 outline-none text-center">',
                '                    <input type="number" id="item-price" placeholder="â‚«å–®åƒ¹" class="w-24 bg-gray-100 dark:bg-gray-700 dark:text-white border-none rounded-lg text-sm px-2 py-2 outline-none">',
                '                    <button onclick="addItem()" class="bg-blue-500 text-white rounded-lg px-3 py-2"><i class="fas fa-plus"></i></button>',
                '                </div>',
                '                <ul id="budget-list" class="space-y-2 text-sm max-h-40 overflow-y-auto dark:text-gray-300"></ul>',
                '            </div>',
                '            <div class="text-center text-xs text-gray-400 py-4 pb-20">æœ¬ç¶²é æ¸¬è©¦ä¸­ï¼Œå¦‚æœ‰å‹˜èª¤è«‹ä¾ç…§ç´™æœ¬èªªæ˜æœƒè³‡æ–™ç‚ºæº–<br>ç¥æ‚¨æ—…é€”æ„‰å¿« Have a Nice Trip</div>',
                '        </div>',
                '',
                '    </main>',
                '',
                '    <!-- Modal for Hotel Card -->',
                '    <div id="hotel-modal" class="fixed inset-0 z-[60] hidden flex items-center justify-center bg-black/80 backdrop-blur-sm p-4" onclick="closeHotelCard()">',
                '        <div class="bg-white w-full max-w-sm rounded-2xl p-6 text-center shadow-2xl relative" onclick="event.stopPropagation()">',
                '            <button onclick="closeHotelCard()" class="absolute top-4 right-4 text-gray-400 text-2xl">&times;</button>',
                '            <p class="text-xs text-gray-400 mb-2 uppercase tracking-widest">Driver Card</p>',
                '            <div class="border-2 border-vn-primary p-4 rounded-xl">',
                '                <p class="text-sm text-gray-500 mb-1">Please take me to:</p>',
                '                <h2 class="text-xl font-black text-vn-primary mb-4 leading-relaxed" id="modal-hotel-name"></h2>',
                '                <hr class="border-dashed border-gray-300 my-3">',
                '                <p class="text-left text-sm font-bold text-gray-700"><span id="modal-hotel-addr"></span></p>',
                '                <p class="text-left text-xs text-gray-400 mt-1">TEL: <span id="modal-hotel-tel"></span></p>',
                '            </div>',
                '            <p class="text-xs text-gray-400 mt-4">(é»æ“ŠèƒŒæ™¯é—œé–‰)</p>',
                '        </div>',
                '    </div>',
                '',
                '    <script>',
                `        // Data Injection`,
                `        const TRIP_DATA = ${jsonStr};`,
                '',
                '        // --- UI Switching ---',
                '        function switchTab(tabName) {',
                '            [\'itinerary\', \'info\', \'tools\'].forEach(t => {',
                '                document.getElementById(\'view-\'+t).classList.add(\'hidden\');',
                '                document.getElementById(\'btn-\'+t).className = \'flex-1 py-3 text-sm tab-inactive transition-all\';',
                '            });',
                '            document.getElementById(\'view-\'+tabName).classList.remove(\'hidden\');',
                '            document.getElementById(\'btn-\'+tabName).className = \'flex-1 py-3 text-sm tab-active transition-all\';',
                '            document.getElementById(\'main-content\').scrollTop = 0;',
                '        }',
                '',
                '        // Toggle Spot Detail',
                '        function toggleDetail(el) {',
                '            const content = el.querySelector(\'.detail-content\');',
                '            const icon = el.querySelector(\'.fa-chevron-down\');',
                '            if (content) {',
                '                if (content.classList.contains(\'hidden\')) {',
                '                    content.classList.remove(\'hidden\');',
                '                    if(icon) icon.classList.add(\'rotate-180\');',
                '                } else {',
                '                    content.classList.add(\'hidden\');',
                '                    if(icon) icon.classList.remove(\'rotate-180\');',
                '                }',
                '            }',
                '        }',
                '',
                '        // --- Hotel Modal ---',
                '        function showHotelCard(name, tel, addr, dayLabel) {',
                '             if(!addr) return;',
                '             document.getElementById(\'modal-hotel-name\').innerHTML = name.replace(/é£¯åº—/g, \'\') + \'<br><span class="text-sm font-normal text-gray-500">(\' + dayLabel + \')</span>\';',
                '             document.getElementById(\'modal-hotel-tel\').innerText = tel;',
                '             document.getElementById(\'modal-hotel-addr\').innerText = addr;',
                '             document.getElementById(\'hotel-modal\').classList.remove(\'hidden\');',
                '        }',
                '        function closeHotelCard() { document.getElementById(\'hotel-modal\').classList.add(\'hidden\'); }',
                '',
                '        // --- Weather Logic (Updated for Vietnam Timezone) ---',
                '        let headerResizeObserver = null;',
                '',
                '        async function fetchWeather() {',
                '            try {',
                '                initDynamicPadding();',
                '',
                '                if (navigator.geolocation) {',
                '                    navigator.geolocation.getCurrentPosition(',
                '                        async (p) => {',
                '                             try {',
                '                                 const res = await fetch(\`https://api.open-meteo.com/v1/forecast?latitude=\${p.coords.latitude}&longitude=\${p.coords.longitude}&current=temperature_2m&timezone=Asia%2FHo_Chi_Minh\`);',
                '                                 const d = await res.json();',
                '                                 if(d.current) document.getElementById(\'header-weather\').innerHTML = \`\${Math.round(d.current.temperature_2m)}<span class="text-sm">Â°C</span>\`;',
                '                                 document.getElementById(\'location-label\').innerHTML = \'<i class="fas fa-map-marker-alt mr-1"></i>æ‰€åœ¨åœ°å³æ™‚\';',
                '                             } catch(e){}',
                '                        }',
                '                    );',
                '                }',
                '',
                '                const now = new Date();',
                '                now.setHours(0,0,0,0);',
                '                const tripDate = new Date(TRIP_DATA.meeting.date);',
                '                tripDate.setHours(0,0,0,0);',
                '                tripDate.setDate(tripDate.getDate() - 1);',
                '                ',
                '                if (now < tripDate) {',
                '                     TRIP_DATA.days.forEach((_, idx) => {',
                '                         const el = document.getElementById(\'weather-stats-\'+idx);',
                '                         if(el) el.innerHTML = \'<span class="text-xs text-gray-400">å¤©æ°£é å ±å°‡æ–¼å‡ºç™¼å‰1å¤©é¡¯ç¤º</span>\';',
                '                     });',
                '                     return;',
                '                }',
                '            } catch(e){}',
                '',
                '            TRIP_DATA.days.forEach(async (day, idx) => {',
                '                if(!day.lat) return;',
                '                try {',
                '                    const res = await fetch(\`https://api.open-meteo.com/v1/forecast?latitude=\${day.lat}&longitude=\${day.lon}&daily=precipitation_probability_max,temperature_2m_max,temperature_2m_min,uv_index_max,weather_code&timezone=Asia%2FHo_Chi_Minh&forecast_days=1\`);',
                '                    const d = await res.json();',
                '                    ',
                '                    let aqi = \'-\';',
                '                    try {',
                '                        const aqiRes = await fetch(\`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=\${day.lat}&longitude=\${day.lon}&daily=us_aqi_max&timezone=Asia%2FHo_Chi_Minh&forecast_days=1\`);',
                '                        const aqiData = await aqiRes.json();',
                '                        if (aqiData.daily && aqiData.daily.us_aqi_max) {',
                '                            aqi = aqiData.daily.us_aqi_max[0];',
                '                        }',
                '                    } catch (aqiErr) {}',
                '',
                '                    if(d.daily) {',
                '                        const rain = d.daily.precipitation_probability_max[0];',
                '                        const max = Math.round(d.daily.temperature_2m_max[0]);',
                '                        const min = Math.round(d.daily.temperature_2m_min[0]);',
                '                        const uv = d.daily.uv_index_max[0];',
                '                        const wCode = d.daily.weather_code[0];',
                '',
                '                        let aqiColor = "text-green-500";',
                '                        if(aqi > 50) aqiColor = "text-yellow-500";',
                '                        if(aqi > 100) aqiColor = "text-orange-500";',
                '                        if(aqi > 150) aqiColor = "text-red-500";',
                '',
                '                        const html = \`',
                '                            <div class="flex gap-3 text-xs w-full">',
                '                                <div class="flex items-center gap-1"><span class="text-red-400 font-bold">æœ€é«˜</span> \${max}Â°</div>',
                '                                <div class="flex items-center gap-1"><span class="text-blue-400 font-bold">æœ€ä½</span> \${min}Â°</div>',
                '                                <div class="flex items-center gap-1"><i class="fas fa-umbrella text-blue-300"></i> \${rain}%</div>',
                '                            </div>',
                '                            <div class="flex gap-3 text-[10px] w-full mt-1 opacity-80">',
                '                                <div><i class="fas fa-sun text-orange-400"></i> UV: \${uv}</div>',
                '                                <div class="\${aqiColor} font-bold"><i class="fas fa-wind"></i> AQI: \${aqi}</div>',
                '                            </div>\`;',
                '                        ',
                '                        document.getElementById(\'weather-stats-\'+idx).innerHTML = html;',
                '                        ',
                '                        let wIcon = \'<i class="fas fa-sun text-orange-400"></i>\';',
                '                        if (wCode >= 1 && wCode <= 3) wIcon = \'<i class="fas fa-cloud-sun text-gray-400"></i>\';',
                '                        else if (wCode >= 45 && wCode <= 48) wIcon = \'<i class="fas fa-smog text-gray-500"></i>\';',
                '                        else if (wCode >= 51 && wCode <= 67) wIcon = \'<i class="fas fa-cloud-rain text-blue-400"></i>\';',
                '                        else if (wCode >= 71 && wCode <= 77) wIcon = \'<i class="fas fa-snowflake text-blue-300"></i>\';',
                '                        else if (wCode >= 80 && wCode <= 82) wIcon = \'<i class="fas fa-cloud-showers-heavy text-blue-500"></i>\';',
                '                        else if (wCode >= 95) wIcon = \'<i class="fas fa-bolt text-yellow-500"></i>\';',
                '                        document.getElementById(\'weather-icon-\'+idx).innerHTML = wIcon;',
                '                    }',
                '                } catch(e){ console.error(e); }',
                '            });',
                '        }',
                '',
                '        function initDynamicPadding() {',
                '            const header = document.getElementById(\'app-header\');',
                '            const main = document.getElementById(\'main-content\');',
                '            if (!header || !main) return;',
                '            const updatePadding = () => {',
                '                const height = header.offsetHeight;',
                '                main.style.paddingTop = (height + 15) + \'px\';',
                '            };',
                '            updatePadding();',
                '            if (headerResizeObserver) headerResizeObserver.disconnect();',
                '            headerResizeObserver = new ResizeObserver(updatePadding);',
                '            headerResizeObserver.observe(header);',
                '            window.addEventListener(\'resize\', updatePadding);',
                '        }',
                '',
                '        function initChecklist() {',
                '            document.querySelectorAll(\'input[type="checkbox"]\').forEach(el => {',
                '                if(localStorage.getItem(el.id) === \'true\') el.checked = true;',
                '            });',
                '        }',
                '        function saveCheck(id) {',
                '            localStorage.setItem(id, document.getElementById(id).checked);',
                '        }',
                '        function resetDailyChecks() {',
                '            document.querySelectorAll(\'input[type="checkbox"][id^="daily_"]\').forEach(chk => {',
                '                chk.checked = false;',
                '                localStorage.setItem(chk.id, \'false\');',
                '            });',
                '            alert(\'æ¯æ—¥æª¢æŸ¥æ¸…å–®å·²é‡ç½®ï¼\');',
                '        }',
                '',
                '        // --- Currency Logic (VND) ---',
                '        let currentRate = 0.0013; // 1 VND approx 0.0013 TWD',
                '        async function fetchRate() {',
                '            try {',
                '                // Fetch TWD rates base to get proper cross rate or fetch VND base',
                '                const res = await fetch(\'https://api.exchangerate-api.com/v4/latest/TWD\');',
                '                const data = await res.json();',
                '                if(data.rates.VND) {',
                '                    // 1 TWD = x VND. So 1 VND = 1/x TWD',
                '                    currentRate = 1 / data.rates.VND;',
                '                    document.getElementById(\'calc-rate-display\').innerText = currentRate.toFixed(5);',
                '                    renderBudget();',
                '                    convertCurrency();',
                '                }',
                '            } catch(e){}',
                '        }',
                '        function convertCurrency() {',
                '            const vnd = parseFloat(document.getElementById(\'calc-vnd\').value);',
                '            if(!isNaN(vnd)) {',
                '                document.getElementById(\'calc-twd\').innerText = Math.round(vnd * currentRate).toLocaleString();',
                '            } else {',
                '                document.getElementById(\'calc-twd\').innerText = \'0\';',
                '            }',
                '        }',
                '',
                '        // --- Budget Logic (No Batch) ---',
                '        let items = [];',
                '        try { const saved = localStorage.getItem(\'trip_budget_vn\'); if (saved) items = JSON.parse(saved); } catch (e) {}',
                '',
                '        function getIntVal(id, def = 1) {',
                '            const val = document.getElementById(id).value;',
                '            return val ? parseInt(val) : def;',
                '        }',
                '',
                '        function renderBudget() {',
                '            const list = document.getElementById(\'budget-list\');',
                '            if(!list) return;',
                '            list.innerHTML = \'\'; let total = 0;',
                '            items.forEach((item, index) => {',
                '                const qty = item.qty || 1;',
                '                const rowTotal = item.price * qty;',
                '                total += rowTotal;',
                '                list.innerHTML += \`<li class="flex justify-between items-center border-b border-gray-50 dark:border-gray-700 pb-1">',
                '                    <span class="text-gray-600 dark:text-gray-300">\${item.name} <span class="text-xs text-gray-400">x\${qty}</span></span>',
                '                    <div class="flex items-center gap-2">',
                '                        <span class="font-medium text-gray-800 dark:text-gray-200">â‚«\${rowTotal.toLocaleString()}</span>',
                '                        <button onclick="deleteItem(\${index})" class="text-gray-300 hover:text-red-400"><i class="fas fa-times"></i></button>',
                '                    </div>',
                '                </li>\`;',
                '            });',
                '            document.getElementById(\'total-amount\').innerText = \'â‚«\' + total.toLocaleString();',
                '            document.getElementById(\'twd-amount\').innerText = Math.round(total * currentRate).toLocaleString();',
                '            try { localStorage.setItem(\'trip_budget_vn\', JSON.stringify(items)); } catch(e) {}',
                '        }',
                '        function addItem() {',
                '            const name = document.getElementById(\'item-name\').value;',
                '            const price = parseInt(document.getElementById(\'item-price\').value);',
                '            const qty = getIntVal(\'item-qty\', 1);',
                '            if (name && price) { ',
                '                items.push({ name, price, qty }); ',
                '                document.getElementById(\'item-name\').value = \'\'; ',
                '                document.getElementById(\'item-price\').value = \'\'; ',
                '                document.getElementById(\'item-qty\').value = \'\'; ',
                '                renderBudget(); ',
                '            }',
                '        }',
                '        function deleteItem(idx) { items.splice(idx, 1); renderBudget(); }',
                '        function resetBudget() { if(confirm(\'æ¸…ç©ºè¨˜å¸³ï¼Ÿ\')) { items = []; renderBudget(); } }',
                '',
                '        // --- Speech (Vietnamese) ---',
                '        function speakVn(text) {',
                '            if (\'speechSynthesis\' in window) {',
                '                // Cancel previous speech',
                '                window.speechSynthesis.cancel();',
                '                const u = new SpeechSynthesisUtterance(text);',
                '                u.lang = \'vi-VN\'; // Vietnamese code',
                '                u.rate = 0.9;',
                '                document.getElementById(\'speak-status\').innerText = \`ğŸ”Š æ’­æ”¾ä¸­: \${text}\`;',
                '                u.onend = function() { document.getElementById(\'speak-status\').innerText = \'\'; };',
                '                // Some browsers need a delay or specific trigger',
                '                setTimeout(() => window.speechSynthesis.speak(u), 10);',
                '            }',
                '        }',
                '',
                '        function callGuide(phone) {',
                '            alert("å»ºè­°å‡ºç™¼å‰ä¸€å¤©å†èˆ‡é ˜éšŠè¯ç¹«ã€‚");',
                '            window.location.href = \'tel:\' + phone;',
                '        }',
                '',
                '        // Init',
                '        fetchWeather();',
                '        fetchRate();',
                '        initChecklist();',
                '        renderBudget();',
                '',
                '    <\/script>',
                '</body>',
                '</html>'
            ];

            return htmlParts.join('\n');
        }

        const GeneratorApp = () => {
            const [data, setData] = useState(DEFAULT_DATA);
            const [status, setStatus] = useState("");
            const [pdfUrl, setPdfUrl] = useState(null);
            const [previewTab, setPreviewTab] = useState('phone'); // 'phone' | 'pdf'

            const updateData = (field, value) => setData(prev => ({ ...prev, [field]: value }));
            const updateInfo = (field, value) => setData(prev => ({ ...prev, info: { ...prev.info, [field]: value } }));
            
            const updateFlight = (idx, field, value) => {
                const newF = [...data.flights];
                newF[idx][field] = value;
                setData(prev => ({ ...prev, flights: newF }));
            };

            const updateDay = (idx, field, value) => {
                const newDays = [...data.days];
                if(field === 'meals') {
                    newDays[idx].meals = { ...newDays[idx].meals, ...value };
                } else {
                    newDays[idx][field] = value;
                }
                
                if(field === 'location' && CITIES[value]) {
                    newDays[idx].lat = CITIES[value].lat;
                    newDays[idx].lon = CITIES[value].lon;
                }
                setData({ ...data, days: newDays });
            };

            const updateDaySpot = (dayIdx, spotIdx, field, value) => {
                const newDays = [...data.days];
                newDays[dayIdx].spots[spotIdx][field] = value;
                setData({ ...data, days: newDays });
            };

            const addSpot = (dayIdx) => {
                const newDays = [...data.days];
                newDays[dayIdx].spots.push({ name: "æ–°æ™¯é»", desc: "è«‹è¼¸å…¥ä»‹ç´¹" });
                setData({ ...data, days: newDays });
            };

            const removeSpot = (dayIdx, spotIdx) => {
                const newDays = [...data.days];
                newDays[dayIdx].spots.splice(spotIdx, 1);
                setData({ ...data, days: newDays });
            };
            
            const addDay = () => {
                const newDays = [...data.days];
                const nextDayNum = newDays.length + 1;
                newDays.push({
                    day: nextDayNum,
                    date: "",
                    location: "æ²³å…§",
                    lat: 21.02, lon: 105.83,
                    spots: [],
                    meals: { b: "", l: "", d: "" },
                    hotel: "",
                    hotelTel: "",
                    hotelAddress: ""
                });
                setData({ ...data, days: newDays });
            };

            const removeDay = (idx) => {
                if (data.days.length <= 1) return;
                if (confirm(`ç¢ºå®šåˆªé™¤ Day ${data.days[idx].day}?`)) {
                    const newDays = data.days.filter((_, i) => i !== idx).map((d, i) => ({ ...d, day: i + 1 }));
                    setData({ ...data, days: newDays });
                }
            };

            // Single File Handler for both Summary and Detail
            const handlePdfUpload = async (e) => {
                const file = e.target.files[0];
                if(!file) return;

                // Create blob URL for PDF preview
                const url = URL.createObjectURL(file);
                setPdfUrl(url);
                setPreviewTab('pdf'); // Auto switch to PDF view

                setStatus("è§£æèªªæ˜æœƒè³‡æ–™...");
                
                const ab = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument(ab).promise;
                let fullText = "";
                let pageOneText = ""; // Store Page 1 separately
                
                for(let i=1; i<=pdf.numPages; i++) {
                    const p = await pdf.getPage(i);
                    const t = await p.getTextContent();
                    const pageStr = t.items.map(s => s.str).join(" ") + "\n";
                    fullText += pageStr;
                    if (i === 1) pageOneText = pageStr;
                }

                const newData = {...data};

                // --- Summary Parsing (Page 1) ---
                // åœ˜è™Ÿè¾¨è­˜ (ä¿®æ­£ regex)
                const codeMatch = pageOneText.match(/(?:åœ˜é«”ç·¨è™Ÿ|åœ˜è™Ÿ)[^\w]*([A-Z0-9]+)/);
                if(codeMatch) newData.tripCode = codeMatch[1].trim();

                const nameMatch = pageOneText.match(/åœ˜é«”åç¨±[:ï¼š\s]*([^\n]+)/); 
                if(nameMatch) newData.tripName = nameMatch[1].trim();

                // é ˜éšŠè¾¨è­˜å¢å¼·
                const guideMatch = pageOneText.match(/é ˜\s*éšŠ[:ï¼š\s]*([^\s\n\*]+)/);
                if(guideMatch) {
                    let gName = guideMatch[1].replace(/[\u3000\sã€Œ]/g, '').trim();
                    if(gName.toUpperCase() === 'NIL' || gName === 'ç„¡' || gName.includes("ç„¡é ˜éšŠ")) gName = ""; 
                    newData.guide.name = gName;
                }

                const phoneMatch = pageOneText.match(/å°ç£æ‰‹æ©Ÿ[:ï¼š\s]*([\d-]+)/);
                if(phoneMatch) newData.guide.twPhone = phoneMatch[1].trim();
                
                const departDateRegex = /å‡ºç™¼æ—¥æœŸ[:ï¼š\s]*(\d{4}\/\d{2}\/\d{2})/;
                const departDateMatch = pageOneText.match(departDateRegex);
                if(departDateMatch) newData.dateRange = departDateMatch[1].trim();

                const meetDateMatch = pageOneText.match(/é›†åˆæ™‚é–“[:ï¼š\s]*(\d{4}\/\d{2}\/\d{2})/);
                const meetTimeMatch = pageOneText.match(/é›†åˆæ™‚é–“[:ï¼š\s]*\d{4}\/\d{2}\/\d{2}\s*(\d{2}:\d{2})/);
                if(meetDateMatch) newData.meeting.date = meetDateMatch[1];
                if(meetTimeMatch) newData.meeting.time = meetTimeMatch[1];
                
                const locRegex = /é›†åˆåœ°é»[:ï¼š\s]*([\s\S]*?)(?=\n|è­˜åˆ¥ç‰Œ|æ©Ÿå ´å°ˆå“¡|ç­æ©Ÿæ™‚åˆ»|$)/;
                const locMatch = pageOneText.match(locRegex);
                if(locMatch) newData.meeting.location = locMatch[1].trim();

                const badgeRegex = /è­˜åˆ¥ç‰Œ[:ï¼š\s]*([^\*]+)/;
                const badgeMatch = pageOneText.match(badgeRegex);
                if(badgeMatch) newData.meeting.badge = badgeMatch[1].trim();
                
                const staffRegex = /æ©Ÿå ´å°ˆå“¡[:ï¼š\s]*([^\n]+?[\d-]+)/;
                const staffMatch = pageOneText.match(staffRegex);
                if(staffMatch) newData.meeting.airportStaff = staffMatch[1].trim();

                // Flight Parser (Unchanged)
                const flightRegex = /(\d{4}\/\d{2}\/\d{2})\s+([A-Z0-9]+?)\s+[A-Z0-9]*\s*(\d{2}:\d{2})\s*-\s*(\d{2}:\d{2})/g;
                const flightsFound = [...pageOneText.matchAll(flightRegex)];
                
                if (flightsFound.length === 0) {
                     const flightRegex2 = /(\d{4}\/\d{2}\/\d{2}).*?([A-Z0-9]{2,}\d{2,}).*?(\d{2}:\d{2}).*?(\d{2}:\d{2})/g;
                     const matches = [...pageOneText.matchAll(flightRegex2)];
                     matches.forEach(m => flightsFound.push(m));
                }
                
                if(flightsFound.length > 0) {
                    const dep = flightsFound[0];
                    newData.flights[0] = {
                        type: "å»ç¨‹", airline: getAirlineName(dep[2]), code: dep[2],
                        date: dep[1].slice(5), depTime: dep[3], depAirport: "TPE", 
                        arrTime: dep[4], arrAirport: "VND" 
                    };
                    if(flightsFound.length > 1) {
                        const ret = flightsFound[1];
                        newData.flights[1] = {
                            type: "å›ç¨‹", airline: getAirlineName(ret[2]), code: ret[2],
                            date: ret[1].slice(5), depTime: ret[3], depAirport: "VND", 
                            arrTime: ret[4], arrAirport: "TPE" 
                        };
                    }
                }

                // --- 1. SKELETON EXTRACTION (Page 1 Only) ---
                // Regex adjusted to be extremely greedy for content inside quotes/commas
                const tableRowRegex = /"ç¬¬\s*(\d+)\s*å¤©"\s*,\s*"([\s\S]*?)"\s*,\s*"([\s\S]*?)"\s*,\s*"([\s\S]*?)"/g;
                const newDays = [];
                
                let match;
                while ((match = tableRowRegex.exec(pageOneText)) !== null) {
                    const dayNum = parseInt(match[1]);
                    const dateRaw = match[2].trim();
                    const routeRaw = match[3].trim();
                    const hotelRaw = match[4].trim();

                    let hotelName = hotelRaw;
                    let hotelTel = "";

                    // Separate TEL from hotel name
                    const telMatch = hotelRaw.match(/TEL[:ï¼š.]?\s*([\d\-\+\s]+)/i);
                    if (telMatch) {
                        hotelTel = telMatch[1].trim();
                        hotelName = hotelRaw.replace(telMatch[0], '').trim();
                    }
                    
                    // Clean hotel name (remove "Hoi An~" prefix etc.)
                    hotelName = hotelName.replace(/^[^~]+~/, ''); 

                    newDays.push({
                        day: dayNum,
                        date: dateRaw.split(' ')[0] || dateRaw, // Clean date
                        location: routeRaw, 
                        lat: 21.02, lon: 105.83, 
                        spots: [],
                        meals: { b: "", l: "", d: "" },
                        hotel: hotelName,
                        hotelTel: hotelTel,
                        hotelAddress: ""
                    });
                }

                // Fallback: If Table parsing failed, try simple line scan
                if (newDays.length === 0) {
                    const simpleDayRegex = /ç¬¬\s*(\d+)\s*å¤©/g;
                    // Scan page 1 for day markers as a last resort
                    const simpleMatches = [...pageOneText.matchAll(simpleDayRegex)];
                    simpleMatches.forEach(m => {
                        const dNum = parseInt(m[1]);
                        if (!newDays.find(d => d.day === dNum)) {
                            newDays.push({
                                day: dNum,
                                date: "", location: "è¶Šå—", lat: 21.02, lon: 105.83,
                                spots: [], meals: { b: "", l: "", d: "" },
                                hotel: "è«‹åƒè€ƒè©³ç´°è¡Œç¨‹", hotelTel: "", hotelAddress: ""
                            });
                        }
                    });
                }

                newDays.sort((a, b) => a.day - b.day);

                // --- 2. DETAIL ENRICHMENT (Scan Full Doc) ---
                if (newDays.length > 0) {
                    const dayChunks = fullText.split(/ç¬¬\s*(\d+)\s*å¤©/); 
                    
                    for (let i = 1; i < dayChunks.length; i += 2) {
                        const dayNum = parseInt(dayChunks[i]);
                        const content = dayChunks[i+1];
                        
                        // Ignore summary table chunks (usually short)
                        if (content.length < 50 && content.includes(",")) continue;

                        const targetDay = newDays.find(d => d.day === dayNum);
                        
                        if (targetDay) {
                            // Extract Meals (Multiple patterns)
                            const bMatch = content.match(/æ—©é¤[X\s]*[:ï¼š](.*?)(?=åˆé¤|ä¸­é¤|æ™šé¤|ä½å®¿|æ™¯é»|â˜…|$)/);
                            const lMatch = content.match(/(?:åˆé¤|ä¸­é¤)[X\s]*[:ï¼š](.*?)(?=æ™šé¤|ä½å®¿|æ™¯é»|â˜…|$)/);
                            const dMatch = content.match(/æ™šé¤[X\s]*[:ï¼š](.*?)(?=ä½å®¿|æ™¯é»|â˜…|$)/);

                            if (bMatch) targetDay.meals.b = bMatch[1].trim();
                            if (lMatch) targetDay.meals.l = lMatch[1].trim();
                            if (dMatch) targetDay.meals.d = dMatch[1].trim();

                            // Extract Spots
                            const spotRegex = /ã€([^ã€‘]+)ã€‘([^ã€]*)/g;
                            let spotMatch;
                            while ((spotMatch = spotRegex.exec(content)) !== null) {
                                const name = spotMatch[1].trim();
                                let desc = spotMatch[2].trim();
                                
                                // Clean description
                                const stopIdx = desc.search(/(?:æ—©é¤|åˆé¤|ä¸­é¤|æ™šé¤|ä½å®¿)[:ï¼š]/);
                                if (stopIdx !== -1) desc = desc.substring(0, stopIdx).trim();
                                
                                // Avoid duplicates
                                if (!targetDay.spots.some(s => s.name === name)) {
                                    targetDay.spots.push({
                                        name: name,
                                        desc: desc || "è©³ç´°è¡Œç¨‹è«‹åƒè€ƒèªªæ˜æœƒè³‡æ–™"
                                    });
                                }
                            }
                            
                            // Refine Location
                            if (targetDay.spots.length > 0 && targetDay.location === "è¶Šå—") {
                                targetDay.location = targetDay.spots[0].name.substring(0, 2);
                            }
                        }
                    }
                    newData.days = newDays;
                } else {
                    // Safe Fallback
                    const dummyDays = [1,2,3,4,5].map(i => ({
                        day: i, date: "", location: "è¶Šå—", lat: 21.02, lon: 105.83,
                        spots: [], meals: {b:"",l:"",d:""}, hotel: "", hotelTel: "", hotelAddress: ""
                    }));
                    newData.days = dummyDays;
                }

                setData(newData);
                setStatus("è³‡æ–™åŒ¯å…¥å®Œæˆï¼");
            };
            
            function getAirlineName(code) {
                if(!code) return "";
                if(code.startsWith('JX')) return 'æ˜Ÿå®‡èˆªç©º';
                if(code.startsWith('BR')) return 'é•·æ¦®èˆªç©º';
                if(code.startsWith('CI')) return 'ä¸­è¯èˆªç©º';
                if(code.startsWith('IT')) return 'å°ç£è™èˆª';
                if(code.startsWith('VN')) return 'è¶Šå—èˆªç©º'; // Vietnam Airlines
                if(code.startsWith('VJ')) return 'è¶Šæ·èˆªç©º'; // VietJet Air
                if(code.startsWith('QH')) return 'è¶Šç«¹èˆªç©º'; // Bamboo Airways
                if(code.startsWith('JL')) return 'æ—¥æœ¬èˆªç©º';
                if(code.startsWith('NH')) return 'å…¨æ—¥ç©º';
                return code.substring(0, 2);
            }

            const download = () => {
                const html = getClientHtml(data);
                const blob = new Blob([html], {type: 'text/html'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `VietnamTrip_${data.tripName || 'æœªå‘½å'}.html`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            };

            return (
                <div className="flex h-screen bg-gray-100">
                    <div className="w-1/2 p-8 overflow-y-auto bg-white shadow-xl z-10">
                        <h1 className="text-3xl font-bold text-gray-800 mb-2">è¶Šå—èªªæ˜æœƒç”¢ç”Ÿå™¨</h1>
                        <p className="text-sm text-gray-500 mb-6">å°ˆç‚ºè¶Šå—æ—…éŠåœ˜é«”è¨­è¨ˆ (VNDåŒ¯ç‡/è¶Šèªç™¼éŸ³/ç•¶åœ°ç·Šæ€¥è¯çµ¡)</p>

                        <div className="bg-blue-50 border border-blue-200 p-6 rounded-xl mb-6 text-center">
                            <h3 className="font-bold text-blue-800 mb-3 text-lg"><i class="fas fa-file-upload"></i> ä¸Šå‚³èªªæ˜æœƒè³‡æ–™ (PDF)</h3>
                            <p className="text-xs text-gray-500 mb-3">ç³»çµ±å°‡è‡ªå‹•è¾¨è­˜è¡Œç¨‹ç¸½è¡¨ã€èˆªç­ã€æ¯æ—¥æ™¯é»èˆ‡é¤é£Ÿ</p>
                            <input type="file" accept=".pdf" onChange={handlePdfUpload} className="block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 mx-auto" />
                        </div>

                        {status && <div className="bg-yellow-50 text-yellow-700 p-2 rounded mb-4 text-sm text-center font-bold animate-pulse">{status}</div>}

                        <hr className="my-6 border-gray-200" />
                        
                        <div className="mb-6 border p-4 rounded-xl bg-indigo-50">
                            <h3 className="font-bold text-indigo-800 mb-2">åŸºæœ¬è³‡æ–™å¾®èª¿</h3>
                            <div className="mb-3">
                                <label className="text-xs text-gray-500 font-bold block mb-1">åœ˜é«”åç¨±</label>
                                <input value={data.tripName} onChange={e=>updateData('tripName', e.target.value)} className="border p-1 rounded text-sm w-full font-bold" placeholder="åœ˜é«”åç¨±" />
                            </div>
                            <div className="grid grid-cols-2 gap-2">
                                <div>
                                    <label className="text-xs text-gray-500 font-bold block mb-1">åœ˜è™Ÿ</label>
                                    <input value={data.tripCode} onChange={e=>updateData('tripCode', e.target.value)} className="border p-1 rounded text-sm w-full" placeholder="åœ˜è™Ÿ" />
                                </div>
                                <div>
                                    <label className="text-xs text-gray-500 font-bold block mb-1">å‡ºç™¼æ—¥æœŸ</label>
                                    <input value={data.meeting.date} onChange={e=>updateData('meeting', {...data.meeting, date: e.target.value})} className="border p-1 rounded text-sm w-full" placeholder="YYYY/MM/DD" />
                                </div>
                            </div>
                        </div>
                        
                        <div className="mb-6 border p-4 rounded-xl bg-gray-50">
                            <h3 className="font-bold text-gray-700 mb-2">é›†åˆè³‡è¨Šå¾®èª¿</h3>
                            <div className="grid grid-cols-2 gap-2 mb-2">
                                <input value={data.meeting.time} onChange={e=>updateData('meeting', {...data.meeting, time: e.target.value})} className="border p-1 rounded text-sm" placeholder="é›†åˆæ™‚é–“" />
                                <input value={data.meeting.badge} onChange={e=>updateData('meeting', {...data.meeting, badge: e.target.value})} className="border p-1 rounded text-sm" placeholder="è­˜åˆ¥ç‰Œé¡è‰²(æ©˜/è—/ç¶ /ç´«)" />
                            </div>
                            <textarea value={data.meeting.location} onChange={e=>updateData('meeting', {...data.meeting, location: e.target.value})} className="border p-1 rounded text-sm w-full mb-2 h-16 resize-none" placeholder="é›†åˆåœ°é»"></textarea>
                            <div className="grid grid-cols-2 gap-2">
                                <input value={data.guide.name} onChange={e=>updateData('guide', {...data.guide, name: e.target.value})} className="border p-1 rounded text-sm w-full" placeholder="é ˜éšŠå§“å (ç•™ç©ºå‰‡éš±è—)" />
                                <input value={data.guide.twPhone} onChange={e=>updateData('guide', {...data.guide, twPhone: e.target.value})} className="border p-1 rounded text-sm w-full" placeholder="é ˜éšŠé›»è©±" />
                            </div>
                            <div className="grid grid-cols-2 gap-2 mt-2">
                                <label className="text-xs text-gray-500 font-bold block mb-1 col-span-2">æ©Ÿå ´å°ˆå“¡</label>
                                <input value={data.meeting.airportStaff} onChange={e=>updateData('meeting', {...data.meeting, airportStaff: e.target.value})} className="border p-1 rounded text-sm w-full col-span-2" placeholder="ä¾‹å¦‚: ç‹å°æ˜ 09xx..." />
                            </div>
                        </div>

                        <div className="mb-6 border p-4 rounded-xl bg-blue-50">
                            <h3 className="font-bold text-blue-800 mb-2"><i class="fas fa-plane"></i> èˆªç­è³‡è¨Šè©³å¡«</h3>
                            {data.flights.map((f, idx) => (
                                <div key={idx} className="mb-3 border-b pb-2 last:border-0">
                                    <div className="flex justify-between font-bold text-sm mb-1">{f.type}</div>
                                    <div className="grid grid-cols-2 gap-2 text-xs">
                                        <input value={f.code} onChange={e=>updateFlight(idx, 'code', e.target.value)} className="border p-1 rounded font-bold text-blue-600" placeholder="èˆªç­ä»£è™Ÿ" />
                                        <input value={f.date} onChange={e=>updateFlight(idx, 'date', e.target.value)} className="border p-1 rounded" placeholder="æ—¥æœŸ" />
                                        <input value={f.depTime} onChange={e=>updateFlight(idx, 'depTime', e.target.value)} className="border p-1 rounded" placeholder="å‡ºç™¼æ™‚é–“" />
                                        <input value={f.depAirport} onChange={e=>updateFlight(idx, 'depAirport', e.target.value)} className="border p-1 rounded" placeholder="å‡ºç™¼æ©Ÿå ´" />
                                        <input value={f.arrTime} onChange={e=>updateFlight(idx, 'arrTime', e.target.value)} className="border p-1 rounded" placeholder="æŠµé”æ™‚é–“" />
                                        <input value={f.arrAirport} onChange={e=>updateFlight(idx, 'arrAirport', e.target.value)} className="border p-1 rounded" placeholder="æŠµé”æ©Ÿå ´" />
                                    </div>
                                </div>
                            ))}
                        </div>

                        <div className="mb-6 border p-4 rounded-xl bg-purple-50">
                            <h3 className="font-bold text-purple-800 mb-2"><i class="fas fa-info-circle"></i> é ˆçŸ¥å…§å®¹ç·¨è¼¯</h3>
                            <div className="space-y-3">
                                <div><label className="text-xs font-bold text-gray-500">å¤©æ°£èˆ‡ç©¿è‘—</label><textarea rows="2" value={data.info.weather} onChange={e=>updateInfo('weather', e.target.value)} className="w-full border rounded p-1 text-sm"></textarea></div>
                                <div><label className="text-xs font-bold text-gray-500">è²¨å¹£åŒ¯ç‡</label><textarea rows="2" value={data.info.currency} onChange={e=>updateInfo('currency', e.target.value)} className="w-full border rounded p-1 text-sm"></textarea></div>
                                <div><label className="text-xs font-bold text-gray-500">è¡Œæ/é›»å£“/ç¦è£½å“</label><textarea rows="2" value={data.info.baggage} onChange={e=>updateInfo('baggage', e.target.value)} className="w-full border rounded p-1 text-sm"></textarea></div>
                                
                                <div><label className="text-xs font-bold text-gray-500">ç´™æœ¬è³‡æ–™ä¸‹è¼‰é€£çµ (PDF)</label><input value={data.info.pdfPath} onChange={e=>updateInfo('pdfPath', e.target.value)} className="w-full border rounded p-1 text-sm" placeholder="è«‹è¼¸å…¥æª”æ¡ˆç¶²å€..." /></div>
                                <div><label className="text-xs font-bold text-gray-500">æ»¿æ„åº¦èª¿æŸ¥é€£çµ (å•å·)</label><input value={data.info.surveyUrl} onChange={e=>updateInfo('surveyUrl', e.target.value)} className="w-full border rounded p-1 text-sm" placeholder="è«‹è¼¸å…¥å•å·ç¶²å€..." /></div>

                                <div className="p-2 border border-yellow-300 bg-yellow-50 rounded">
                                    <label className="text-xs font-bold text-yellow-700 mb-1 block">æœå‹™è²»è¨­å®š (è‹¥ç„¡é ˜éšŠå°‡è‡ªå‹•èª¿æ•´é¡¯ç¤ºæ–‡å­—)</label>
                                    <div className="flex gap-2">
                                        <input type="text" value={data.info.tips.currency} onChange={e=>updateInfo('tips', {...data.info.tips, currency: e.target.value})} className="border p-1 rounded text-xs w-1/3" placeholder="å¹£åˆ¥" />
                                        <input type="number" value={data.info.tips.perDay} onChange={e=>updateInfo('tips', {...data.info.tips, perDay: parseInt(e.target.value) || 0})} className="border p-1 rounded text-xs w-1/3" placeholder="æ¯æ—¥é‡‘é¡" />
                                        <input type="number" value={data.info.tips.days} onChange={e=>updateInfo('tips', {...data.info.tips, days: parseInt(e.target.value) || 0})} className="border p-1 rounded text-xs w-1/3" placeholder="å¤©æ•¸" />
                                    </div>
                                </div>

                                <div>
                                    <label className="text-xs font-bold text-gray-500 text-pink-600">åœ–ç‰‡ç¶²å€ (å¯å¤šå¼µï¼Œæ›è¡Œåˆ†éš”)</label>
                                    <textarea rows="4" value={data.info.imageRoot} onChange={e=>updateInfo('imageRoot', e.target.value)} className="w-full border border-pink-200 rounded p-1 text-sm text-pink-600" placeholder="imgs/1.jpg..."></textarea>
                                </div>
                            </div>
                        </div>

                        <div className="space-y-6">
                            {data.days.map((day, dIdx) => (
                                <div key={dIdx} className="border p-4 rounded-xl bg-gray-50 hover:bg-white transition-shadow shadow-sm">
                                    <div className="flex justify-between items-center mb-3 border-b pb-2">
                                        <div className="flex gap-2 items-center flex-1">
                                            <span className="bg-red-600 text-white px-2 py-1 rounded text-xs font-bold">Day {day.day}</span>
                                            <input value={day.date} onChange={e=>updateDay(dIdx, 'date', e.target.value)} className="border p-1 rounded text-sm w-16 text-center font-bold text-gray-500" placeholder="æ—¥æœŸ" />
                                            <div className="flex gap-1 flex-1">
                                                <select value={Object.keys(CITIES).find(k=>CITIES[k].lat===day.lat) || ''} onChange={e=>updateDay(dIdx, 'location', e.target.value)} className="border p-1 rounded text-sm bg-orange-50 font-bold text-orange-700 w-24">
                                                    {Object.keys(CITIES).map(c=><option key={c} value={c}>{c}</option>)}
                                                </select>
                                                <input value={day.location} onChange={e=>updateDay(dIdx, 'location', e.target.value)} className="border p-1 rounded text-sm w-full" placeholder="è‡ªè¨‚åœ°é»" />
                                            </div>
                                        </div>
                                        <div className="flex items-center gap-1 ml-2">
                                            <button onClick={()=>addSpot(dIdx)} className="text-xs bg-green-100 text-green-700 px-2 py-1 rounded hover:bg-green-200"><i className="fas fa-plus"></i></button>
                                            <button onClick={()=>removeDay(dIdx)} className="text-xs bg-red-100 text-red-700 px-2 py-1 rounded hover:bg-red-200"><i className="fas fa-trash"></i></button>
                                        </div>
                                    </div>
                                    
                                    <div className="grid grid-cols-3 gap-2 mb-3 text-xs">
                                        <div><label className="text-gray-400 block mb-1">æ—©é¤</label><input value={day.meals.b} onChange={e=>updateDay(dIdx, 'meals', {...day.meals, b: e.target.value})} className="border p-1 rounded w-full" /></div>
                                        <div><label className="text-gray-400 block mb-1">åˆé¤</label><input value={day.meals.l} onChange={e=>updateDay(dIdx, 'meals', {...day.meals, l: e.target.value})} className="border p-1 rounded w-full" /></div>
                                        <div><label className="text-gray-400 block mb-1">æ™šé¤</label><input value={day.meals.d} onChange={e=>updateDay(dIdx, 'meals', {...day.meals, d: e.target.value})} className="border p-1 rounded w-full" /></div>
                                    </div>

                                    <div className="space-y-3 mb-3">
                                        {day.spots.map((spot, sIdx) => (
                                            <div key={sIdx} className="bg-white border rounded p-3 relative group">
                                                <input value={spot.name} onChange={e=>updateDaySpot(dIdx, sIdx, 'name', e.target.value)} className="w-full font-bold text-gray-800 border-b mb-2 pb-1 outline-none text-sm" placeholder="æ™¯é»åç¨±" />
                                                <textarea rows="3" value={spot.desc} onChange={e=>updateDaySpot(dIdx, sIdx, 'desc', e.target.value)} className="w-full text-xs text-gray-500 outline-none resize-none" placeholder="æ™¯é»ä»‹ç´¹"></textarea>
                                                <button onClick={()=>removeSpot(dIdx, sIdx)} className="absolute top-2 right-2 text-gray-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity"><i class="fas fa-trash"></i></button>
                                            </div>
                                        ))}
                                    </div>
                                    <div className="flex gap-2 text-xs mb-2">
                                        <input value={day.hotel} onChange={e=>updateDay(dIdx, 'hotel', e.target.value)} className="flex-1 border p-1 rounded font-bold" placeholder="ä½å®¿é£¯åº—" />
                                        <input value={day.hotelTel} onChange={e=>updateDay(dIdx, 'hotelTel', e.target.value)} className="w-24 border p-1 rounded" placeholder="é›»è©±" />
                                    </div>
                                    <div className="flex gap-2 text-xs">
                                        <input value={day.hotelAddress} onChange={e=>updateDay(dIdx, 'hotelAddress', e.target.value)} className="flex-1 border p-1 rounded" placeholder="é£¯åº—åœ°å€ (è¼¸å…¥å¾Œæ‰æœƒé¡¯ç¤ºå¸æ©Ÿå¡)" />
                                    </div>
                                </div>
                            ))}
                        </div>

                        <div className="text-center mb-6 mt-4">
                            <button onClick={addDay} className="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg border-2 border-dashed border-gray-400 w-full transition-colors">
                                <i className="fas fa-plus-circle mr-1"></i> æ–°å¢ä¸€å¤©è¡Œç¨‹
                            </button>
                        </div>

                        <button onClick={download} className="w-full mt-8 bg-vn-primary hover:bg-teal-800 text-white py-4 rounded-xl font-bold text-lg shadow-lg transition-transform active:scale-95">
                            <i class="fas fa-download mr-2"></i> åŒ¯å‡ºè¶Šå—ç‰ˆç¶²é  (HTML)
                        </button>
                    </div>

                    <div className="w-1/2 flex flex-col h-screen">
                        {/* Top Navigation Bar for Preview */}
                        <div className="bg-white border-b border-gray-200 p-3 flex justify-center items-center shadow-sm z-20">
                             <div className="flex bg-gray-100 p-1 rounded-lg">
                                 <button 
                                    onClick={() => setPreviewTab('phone')}
                                    className={`px-6 py-2 rounded-md text-sm font-bold transition-all ${previewTab === 'phone' ? 'bg-white text-vn-primary shadow-sm' : 'text-gray-500 hover:text-gray-700'}`}
                                 >
                                    <i className="fas fa-mobile-alt mr-2"></i>æ‰‹æ©Ÿé è¦½
                                 </button>
                                 <button 
                                    onClick={() => setPreviewTab('pdf')}
                                    className={`px-6 py-2 rounded-md text-sm font-bold transition-all ${previewTab === 'pdf' ? 'bg-white text-vn-primary shadow-sm' : 'text-gray-500 hover:text-gray-700'}`}
                                 >
                                    <i className="fas fa-file-pdf mr-2"></i>åŸå§‹ PDF
                                 </button>
                             </div>
                        </div>

                        {/* Preview Area */}
                        <div className="flex-1 bg-gray-200 flex items-center justify-center relative overflow-hidden p-4">
                            {/* Content */}
                            {previewTab === 'phone' ? (
                                <div className="phone-frame w-[375px] h-[750px] transition-all duration-300 shadow-2xl scale-90 sm:scale-100 origin-center">
                                    <div className="phone-notch"></div>
                                    <iframe srcDoc={getClientHtml(data)} className="w-full h-full border-none"></iframe>
                                </div>
                            ) : (
                                <div className="w-full h-full flex items-center justify-center">
                                    {pdfUrl ? (
                                        <iframe src={pdfUrl} className="w-full h-full rounded-xl shadow-2xl border border-gray-300 bg-white" title="PDF Preview"></iframe>
                                    ) : (
                                        <div className="text-center text-gray-400 p-10 border-4 border-dashed border-gray-300 rounded-xl bg-gray-50/50">
                                            <i className="fas fa-file-pdf text-6xl mb-4 text-gray-300"></i>
                                            <p className="font-bold">å°šæœªä¸Šå‚³ PDF æª”æ¡ˆ</p>
                                            <p className="text-xs mt-2">è«‹å¾å·¦å´ä¸Šå‚³èªªæ˜æœƒè³‡æ–™</p>
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<GeneratorApp />);
    </script>
</body>
</html>